/* ============================================
   FONT IMPORTS
   ============================================ */
@import '@fontsource-variable/dm-sans';
@import '@fontsource-variable/jetbrains-mono';

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================
   LIGHT THEME (Default)
   Supports both :root and [data-theme="light"]
   ============================================ */
:root,
[data-theme="light"] {
  /* Typography (new design system fonts with Geist fallback) */
  --font-sans: 'DM Sans Variable', var(--font-geist-sans), 'Inter', system-ui, -apple-system, sans-serif;
  --font-mono: 'JetBrains Mono Variable', var(--font-geist-mono), 'Menlo', 'Monaco', monospace;

  /* Surface hierarchy - Warm Stone */
  --surface: #FAF9F7;
  --surface-raised: #FFFFFF;
  --surface-elevated: #F8F6F3;
  --surface-overlay: #27272a;
  --surface-sunken: #F5F3EF;

  /* Surface aliases for compatibility */
  --surface-base: var(--surface);
  --surface-secondary: var(--surface-raised);
  --surface-tertiary: var(--surface-elevated);
  --surface-invert: #18181b;

  /* Borders - Warm tones */
  --border-subtle: #F0EDE8;
  --border-muted: #E8E4DE;
  --border-prominent: #DDD8D0;
  --border-strong: #DDD8D0;
  --border-focus: #D4716A;

  /* Border aliases */
  --border-default: var(--border-muted);
  --border-hover: var(--border-prominent);
  --border-active: var(--accent-primary);

  /* Text hierarchy - Warm neutrals */
  --text-primary: #2D2A26;
  --text-secondary: #5C5752;
  --text-tertiary: #7A756D;
  --text-muted: #9A958D;
  --text-placeholder: #9A958D;

  /* Text aliases */
  --text-invert: #fafafa;
  --text-link: var(--accent-primary);
  --text-link-hover: var(--accent-primary-hover);

  /* Primary accent - Dusty Coral */
  --accent-primary: #D4716A;
  --accent-primary-hover: #C46359;
  --accent-primary-muted: rgba(212, 113, 106, 0.1);
  --accent-primary-subtle: #FBF0EF;

  /* Semantic colors (compatibility aliases point to new values) */
  --accent-blue: #0E7490;
  --accent-green: #2D8A6E;
  --accent-yellow: #D97706;
  --accent-red: #B54D42;
  --accent-purple: #7C3AED;
  --accent-cyan: #D4716A;
  --accent-orange: #F97316;
  --accent-pink: #EC4899;

  /* Semantic colors - new design tokens */
  --semantic-success: #2D8A6E;
  --semantic-success-text: #1E6B54;
  --semantic-success-muted: #E6F4EF;
  --semantic-error: #B54D42;
  --semantic-error-text: #9C4338;
  --semantic-error-muted: #FDF4F3;
  --semantic-warning: #D97706;
  --semantic-warning-muted: #FEF8E8;
  --semantic-info: #0E7490;
  --semantic-info-muted: #ECFEFF;

  /* Trend indicators */
  --trend-positive: #1E6B54;
  --trend-negative: #9C4338;
  --trend-neutral: #7A756D;

  /* Chart colors - Coral palette */
  --chart-1: #D4716A;
  --chart-2: #2D8A6E;
  --chart-3: #D97706;
  --chart-4: #0E7490;
  --chart-5: #7C3AED;
  --chart-6: #EC4899;
  --chart-grid: #E8E4DE;
  --chart-axis: #7A756D;
  --chart-tooltip-bg: #ffffff;
  --chart-tooltip-border: #E8E4DE;

  /* Shadows - warm tint */
  --shadow-xs: 0 1px 2px rgba(45, 42, 38, 0.04);
  --shadow-sm: 0 2px 4px rgba(45, 42, 38, 0.06), 0 1px 2px rgba(45, 42, 38, 0.04);
  --shadow-md: 0 4px 8px rgba(45, 42, 38, 0.08), 0 2px 4px rgba(45, 42, 38, 0.04);
  --shadow-focus: 0 0 0 3px rgba(212, 113, 106, 0.25);

  /* Component-specific tokens */
  /* Table */
  --table-header-bg: var(--surface-raised);
  --table-row-hover: var(--surface-raised);
  --table-row-selected: var(--accent-primary-muted);
  --table-border: var(--border-subtle);

  /* Sidebar */
  --sidebar-bg: var(--surface);
  --sidebar-item-hover: var(--surface-raised);
  --sidebar-item-active: var(--accent-primary-muted);
  --sidebar-text: var(--text-secondary);
  --sidebar-text-active: var(--accent-primary);

  /* Card */
  --card-bg: var(--surface);
  --card-border: var(--border-subtle);
  --card-shadow: var(--shadow-sm);

  /* Input */
  --input-bg: var(--surface);
  --input-border: var(--border-muted);
  --input-border-focus: var(--accent-primary);
  --input-placeholder: var(--text-muted);

  /* Badge */
  --badge-default-bg: var(--surface-elevated);
  --badge-default-text: var(--text-secondary);
  --badge-primary-bg: var(--accent-primary-muted);
  --badge-primary-text: var(--accent-primary);
  --badge-success-bg: var(--semantic-success-muted);
  --badge-success-text: var(--semantic-success);
  --badge-warning-bg: var(--semantic-warning-muted);
  --badge-warning-text: var(--semantic-warning);
  --badge-error-bg: var(--semantic-error-muted);
  --badge-error-text: var(--semantic-error);

  /* Focus ring */
  --focus-ring: var(--accent-primary);
  --focus-ring-offset: var(--surface);
}

/* ============================================
   DARK THEME
   Supports both .dark class and [data-theme="dark"]
   ============================================ */
.dark,
[data-theme="dark"] {
  /* Typography (same fonts) */
  --font-sans: 'DM Sans Variable', var(--font-geist-sans), 'Inter', system-ui, -apple-system, sans-serif;
  --font-mono: 'JetBrains Mono Variable', var(--font-geist-mono), 'Menlo', 'Monaco', monospace;

  /* Surface hierarchy - Warm Dark */
  --surface: #1A1816;
  --surface-raised: #211F1C;
  --surface-elevated: #292623;
  --surface-overlay: #292623;
  --surface-sunken: #151311;

  /* Surface aliases for compatibility */
  --surface-base: var(--surface);
  --surface-secondary: var(--surface-raised);
  --surface-tertiary: var(--surface-elevated);
  --surface-invert: #fafafa;

  /* Borders - Warm dark tones */
  --border-subtle: #292623;
  --border-muted: #332F2A;
  --border-prominent: #3D3935;
  --border-strong: #3D3935;
  --border-focus: #E07D75;

  /* Border aliases */
  --border-default: var(--border-muted);
  --border-hover: var(--border-prominent);
  --border-active: var(--accent-primary);

  /* Text hierarchy - Warm neutrals */
  --text-primary: #E8E4DE;
  --text-secondary: #B5B0A8;
  --text-tertiary: #8A847A;
  --text-muted: #6B665E;
  --text-placeholder: #6B665E;

  /* Text aliases */
  --text-invert: #0f172a;
  --text-link: var(--accent-primary);
  --text-link-hover: var(--accent-primary-hover);

  /* Primary accent - Coral (brighter for dark mode) */
  --accent-primary: #E07D75;
  --accent-primary-hover: #E68D86;
  --accent-primary-muted: rgba(224, 125, 117, 0.12);
  --accent-primary-subtle: rgba(224, 125, 117, 0.12);

  /* Semantic colors (compatibility aliases) */
  --accent-blue: #38BDF8;
  --accent-green: #5DD4A8;
  --accent-yellow: #FBBF24;
  --accent-red: #CF7F76;
  --accent-purple: #A78BFA;
  --accent-cyan: #E07D75;
  --accent-orange: #FB923C;
  --accent-pink: #F472B6;

  /* Semantic colors - new design tokens */
  --semantic-success: #5DD4A8;
  --semantic-success-text: #5DD4A8;
  --semantic-success-muted: rgba(93, 212, 168, 0.12);
  --semantic-error: #CF7F76;
  --semantic-error-text: #CF7F76;
  --semantic-error-muted: rgba(207, 127, 118, 0.12);
  --semantic-warning: #FBBF24;
  --semantic-warning-muted: rgba(251, 191, 36, 0.12);
  --semantic-info: #38BDF8;
  --semantic-info-muted: rgba(56, 189, 248, 0.12);

  /* Trend indicators */
  --trend-positive: #5DD4A8;
  --trend-negative: #CF7F76;
  --trend-neutral: #8A847A;

  /* Chart colors - Dark palette */
  --chart-1: #E07D75;
  --chart-2: #5DD4A8;
  --chart-3: #FBBF24;
  --chart-4: #38BDF8;
  --chart-5: #A78BFA;
  --chart-6: #F472B6;
  --chart-grid: #332F2A;
  --chart-axis: #8A847A;
  --chart-tooltip-bg: #211F1C;
  --chart-tooltip-border: #3D3935;

  /* Shadows - dark mode */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.16);
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.20), 0 1px 2px rgba(0, 0, 0, 0.12);
  --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.24), 0 2px 4px rgba(0, 0, 0, 0.16);
  --shadow-focus: 0 0 0 3px rgba(224, 125, 117, 0.3);

  /* Component-specific tokens */
  /* Table */
  --table-header-bg: var(--surface-raised);
  --table-row-hover: var(--surface-raised);
  --table-row-selected: var(--accent-primary-muted);
  --table-border: var(--border-subtle);

  /* Sidebar */
  --sidebar-bg: var(--surface);
  --sidebar-item-hover: var(--surface-raised);
  --sidebar-item-active: var(--accent-primary-muted);
  --sidebar-text: var(--text-secondary);
  --sidebar-text-active: var(--accent-primary);

  /* Card */
  --card-bg: var(--surface);
  --card-border: var(--border-subtle);
  --card-shadow: var(--shadow-sm);

  /* Input */
  --input-bg: var(--surface);
  --input-border: var(--border-muted);
  --input-border-focus: var(--accent-primary);
  --input-placeholder: var(--text-muted);

  /* Badge */
  --badge-default-bg: var(--surface-elevated);
  --badge-default-text: var(--text-secondary);
  --badge-primary-bg: var(--accent-primary-muted);
  --badge-primary-text: var(--accent-primary);
  --badge-success-bg: var(--semantic-success-muted);
  --badge-success-text: var(--semantic-success);
  --badge-warning-bg: var(--semantic-warning-muted);
  --badge-warning-text: var(--semantic-warning);
  --badge-error-bg: var(--semantic-error-muted);
  --badge-error-text: var(--semantic-error);

  /* Focus ring */
  --focus-ring: var(--accent-primary);
  --focus-ring-offset: var(--surface);
}

/* ============================================
   BASE STYLES
   ============================================ */
@layer base {
  * {
    @apply border-border-subtle;
  }

  html {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  /* Dynamic viewport height support for iOS/iPad Safari */
  /* Uses dvh with vh fallback for older browsers */
  .h-screen-safe {
    height: 100vh;
    height: 100dvh;
  }

  .min-h-screen-safe {
    min-height: 100vh;
    min-height: 100dvh;
  }

  /* Safe area insets for notched/tabbed devices */
  .pt-safe {
    padding-top: max(1rem, env(safe-area-inset-top));
  }

  .top-safe {
    top: max(1rem, env(safe-area-inset-top));
  }

  body {
    @apply bg-surface text-text-primary font-sans;
    transition: background-color 200ms ease, color 200ms ease;
  }

  /* Focus ring styles */
  *:focus-visible {
    @apply outline-none ring-2 ring-accent-primary ring-offset-2 ring-offset-surface;
  }

  /* Selection - coral tint */
  ::selection {
    background-color: rgba(212, 113, 106, 0.2);
  }

  .dark ::selection,
  [data-theme="dark"] ::selection {
    background-color: rgba(224, 125, 117, 0.2);
  }
}

/* ============================================
   UTILITY CLASSES
   ============================================ */
@layer utilities {
  /* Custom scrollbar */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: var(--border-muted) transparent;
  }

  .scrollbar-thin::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .scrollbar-thin::-webkit-scrollbar-track {
    background: transparent;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: var(--border-muted);
    border-radius: 4px;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    background-color: var(--border-prominent);
  }

  /* Hide scrollbar but keep scrolling */
  .scrollbar-none {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-none::-webkit-scrollbar {
    display: none;
  }

  /* Text gradient utility */
  .text-gradient {
    @apply bg-gradient-to-r from-accent-primary to-accent-pink bg-clip-text text-transparent;
  }

  /* Monospace tabular numbers for data display */
  .font-data {
    font-family: var(--font-mono);
    font-variant-numeric: tabular-nums;
    letter-spacing: -0.01em;
  }

  /* Glass effect */
  .glass {
    @apply bg-surface-raised/80 backdrop-blur-sm;
  }

  /* Hover lift effect */
  .hover-lift {
    @apply transition-transform duration-150 hover:-translate-y-0.5;
  }

  /* Animation delay utilities */
  .animation-delay-100 { animation-delay: 100ms; }
  .animation-delay-200 { animation-delay: 200ms; }
  .animation-delay-300 { animation-delay: 300ms; }
  .animation-delay-400 { animation-delay: 400ms; }
  .animation-delay-500 { animation-delay: 500ms; }
}

/* ============================================
   COMPONENT STYLES
   ============================================ */
@layer components {
  /* Chat prose styling for rich markdown */
  .prose-chat {
    @apply text-text-primary;
  }

  .prose-chat > *:first-child {
    @apply mt-0;
  }

  .prose-chat > *:last-child {
    @apply mb-0;
  }

  /* Smooth fade-in for new messages */
  .message-fade-in {
    animation: messageFadeIn 0.2s ease-out;
  }

  @keyframes messageFadeIn {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Streaming cursor blink */
  .streaming-cursor {
    animation: cursorBlink 1s ease-in-out infinite;
  }

  @keyframes cursorBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }
}
