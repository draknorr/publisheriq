# PublisherIQ v2.0 - New Design Release

**Release Date:** January 3, 2026 (merged to main January 7, 2026)
**Branch:** `new-design` (now merged to `main`)
**Total Commits:** 46+
**Net Code Change:** +2,157 lines

**Post-Release Updates (January 7, 2026):**
- Fixed game search excluding games with NULL pics_review_percentage
- Added sync job concurrency protection with 2-hour timeout detection
- Added complete Steam category name mappings (70 categories)
- Fixed iPad scrollbar issues and improved theme toggle visibility

## Executive Summary

Version 2.0 represents a comprehensive visual and functional overhaul of PublisherIQ. Key highlights include:

- **Complete Design System:** Dual light/dark theme with Geist typography
- **66% Query Reduction:** Admin dashboard optimized from ~40 queries to ~12
- **New Metrics:** Estimated weekly/monthly played hours at game, publisher, and developer levels
- **Enhanced Chat/LLM:** Retry logic, tag normalization, and improved query routing
- **Mobile-Responsive:** All detail pages now work seamlessly on mobile devices

---

## Changelog by Category

### Design System Foundation (6 commits)

| Commit | Description |
|--------|-------------|
| `42b0db3` | New design system with dual light/dark themes, Geist font, CSS variables |
| `66767db` | Light mode default, remove AI badge, rename Dashboard to Home |
| `c88ed96` | Redesign admin dashboard with dense, single-page layout |
| `d1688b8` | Admin dashboard: expand all sections, fix PICS layout |
| `4a28519` | Redesign apps pages with information-dense layout |
| `b949091` | Redesign developers & publishers pages with compact layout |

**Key Files Modified:**
- `apps/admin/src/app/globals.css` - CSS variables and theme definitions
- `apps/admin/tailwind.config.cjs` - Tailwind theme extensions
- `apps/admin/src/app/layout.tsx` - ThemeProvider integration

**New Documentation:** [Design System Architecture](../developer-guide/architecture/design-system.md)

---

### Page Layout Redesigns (6 commits)

| Commit | Description |
|--------|-------------|
| `2d38a31` | Redesign developer detail page with waffle chart and animations |
| `b81035d` | Fix developer page: genre chart, expandable sections, reviews table |
| `df88892` | Redesign publisher detail page to match developers page |
| `2e49939` | Move chat logs into admin dashboard section |
| `ab042cc` | Redesign app detail page with unified Summary section |
| `932c21d` | Add mobile-responsive layouts across all detail pages |

**Key Files Modified:**
- `apps/admin/src/app/(main)/apps/[appid]/AppDetailSections.tsx`
- `apps/admin/src/app/(main)/developers/[id]/DeveloperDetailSections.tsx`
- `apps/admin/src/app/(main)/publishers/[id]/PublisherDetailSections.tsx`

---

### App Detail Page Refinements (9 commits)

| Commit | Description |
|--------|-------------|
| `6f86ef5` | Redesign app detail Summary section for consistency |
| `0aaa929` | Spell out Developer/Publisher labels, move Genres to own row |
| `6a518eb` | Move Genres into Platform Stats row as a card |
| `84615b7` | Fix page width overflow at layout level |
| `dfba221` | Make Quick Facts grid fit full width |
| `7ed15b6` | Add w-full to SimilaritySection compact mode containers |
| `ff8a7ec` | Fix page width overflow from SimilaritySection compact mode |
| `66ea3a9` | Remove PICS references and constrain metadata grid width |
| `d3e8420` | Fix tags overflow and improve chart tooltip styling |

---

### Data Formatting & Date Handling (6 commits)

| Commit | Description |
|--------|-------------|
| `3474fa9` | Fix review histogram: aggregate by month instead of exact date |
| `d16aca7` | Fix: Validate month_start format before parsing dates |
| `f9fc1b6` | Fix: Filter out malformed month_start entries at source |
| `8ee39d5` | Fix: Use deterministic month formatting to prevent hydration mismatch |
| `ac94a35` | Fix duplicate months in Reviews section on app detail page |
| `040b1f5` | Fix: Remove spurious "0" next to app names in apps list |

---

### Performance Optimizations (4 commits)

| Commit | Description |
|--------|-------------|
| `5acb3f1` | Optimize admin dashboard: reduce queries from ~40 to ~12 |
| `4545298` | Fix PICS data stats fallback when RPC returns zeros |
| `ff92cce` | Fix priority calculation timeout by using bulk upsert |
| `743c347` | Add dynamic page titles for browser tabs |

**New Documentation:** [Admin Dashboard Architecture](../developer-guide/features/admin-dashboard.md)

---

### Chat/LLM Enhancements (6 commits)

| Commit | Description |
|--------|-------------|
| `a833bdc` | Fix Cube.dev 502 errors with retry logic and pricing fallback |
| `07d812d` | Add discount/deals support to chat queries |
| `ab86733` | Fix tag-based query routing for chat queries |
| `02ec5f9` | Fix co-op tag search returning 0 results |
| `a4f11df` | Add action buttons and responsive prompt display to Chat Logs |
| `a62dca4` | Fix chat input alignment with send/stop buttons |

**Technical Details:**
- 3 retries with exponential backoff (500ms-4s) for 502/503/504 errors
- 30s timeout using AbortController for Cube.dev queries
- Tag normalization: "coop" automatically converted to "co-op"
- Fallback to search categories when tags return 0 results

---

### New Metrics Features (6 commits)

| Commit | Description |
|--------|-------------|
| `423b8c9` | Add estimated weekly played hours metric for publishers/developers |
| `55bb1e2` | Fix table formatting in estimated played hours example |
| `3e8942d` | Add estimatedWeeklyHours to game level (Discovery cube) |
| `65234bb` | Fix played hours time filtering guidance in LLM prompt |
| `f02fc98` | Add monthly estimated played hours support |
| `ee61aa5` | Add monthly publisher metrics for time-filtered queries |

**New Documentation:** [New Metrics Reference](../reference/new-metrics.md)

---

### Data Integration Fixes (2 commits)

| Commit | Description |
|--------|-------------|
| `c2ea68f` | Fix developer/publisher tags to use PICS data instead of empty app_tags table |
| `8928fbd` | Fix flex-wrap overflow by adding w-full constraint |

---

## Database Migrations

Five new migrations are included in this release:

| Migration | Purpose |
|-----------|---------|
| `20260103000001_add_admin_dashboard_rpcs.sql` | RPC functions for efficient dashboard queries |
| `20260103000002_add_estimated_weekly_hours.sql` | Estimated weekly hours for publishers/developers |
| `20260103000003_add_game_estimated_weekly_hours.sql` | Game-level estimated weekly hours |
| `20260103000004_add_monthly_game_metrics.sql` | Monthly game metrics view |
| `20260103000005_add_monthly_publisher_metrics.sql` | Monthly publisher metrics view |

### Migration Commands

```bash
# Apply all migrations
npx supabase db push

# Or apply individually
npx supabase migration up 20260103000001
npx supabase migration up 20260103000002
npx supabase migration up 20260103000003
npx supabase migration up 20260103000004
npx supabase migration up 20260103000005
```

---

## New Components

| Component | Location | Purpose |
|-----------|----------|---------|
| `ThemeContext` | `src/components/theme/` | Theme state management with localStorage persistence |
| `ThemeToggle` | `src/components/theme/` | Animated sun/moon toggle button |
| `CollapsibleSection` | `src/components/ui/` | Expandable section with badge variants |
| `DenseMetricGrid` | `src/components/data-display/` | Compact metric display with status colors |
| `StatusBar` | `src/components/data-display/` | Top-level status indicators |
| `MiniProgressBar` | `src/components/data-display/` | Small progress indicators with auto-variant |
| `SourceCompletionCard` | `src/components/data-display/` | Data source completion cards |
| `CompactSimilarityCard` | `src/components/similarity/` | Horizontal similar games display |

---

## Breaking Changes

### CSS Class Changes

The following Tailwind classes now use CSS variables instead of hardcoded colors:

```diff
- bg-gray-50
+ bg-surface-raised

- text-gray-900
+ text-text-primary

- border-gray-200
+ border-border-subtle
```

### Theme Migration

If you have custom components, update them to use the new design tokens:

```tsx
// Before
<div className="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">

// After
<div className="bg-surface text-text-primary">
```

---

## Upgrade Instructions

1. **Pull the branch:**
   ```bash
   git checkout new-design
   git pull origin new-design
   ```

2. **Install dependencies:**
   ```bash
   pnpm install
   ```

3. **Apply database migrations:**
   ```bash
   npx supabase db push
   ```

4. **Refresh materialized views:**
   ```sql
   REFRESH MATERIALIZED VIEW CONCURRENTLY publisher_metrics;
   REFRESH MATERIALIZED VIEW CONCURRENTLY developer_metrics;
   ```

5. **Rebuild and deploy:**
   ```bash
   pnpm build
   ```

---

## Related Documentation

- [Design System Architecture](../developer-guide/architecture/design-system.md)
- [Theming Guide](../user-guide/theming.md)
- [New Metrics Reference](../reference/new-metrics.md)
- [Admin Dashboard Architecture](../developer-guide/features/admin-dashboard.md)
