# v2.5 Release Notes - Companies Page

**Release Date:** January 15, 2026

---

## Overview

Version 2.5 introduces the **Companies Page**, a unified analytics dashboard that replaces the separate `/publishers` and `/developers` index pages with a single, powerful `/companies` page featuring advanced filtering, comparison, export, and saved views.

### Highlights

- **Unified View** - Browse publishers and developers together or filter by type
- **Advanced Filtering** - 9 filter categories with 25+ filter parameters
- **17 Customizable Columns** - Toggle visibility across 7 metric categories
- **Compare Mode** - Side-by-side comparison of 2-5 companies
- **Export** - CSV/JSON export with configurable columns
- **Saved Views** - Save and load filter configurations
- **Computed Ratios** - Revenue/Game, Owners/Game, Reviews per 1K Owners
- **Sparkline Visualizations** - Inline CCU trend graphs

---

## New Features

### Unified Companies Page

A single page at `/companies` showing both publishers and developers with a type toggle:

| Type | Description |
|------|-------------|
| All | Shows all publishers and developers with role badge |
| Publishers | Publishers only (hides Role column) |
| Developers | Developers only (hides Role and Unique Devs columns) |

**URL Parameters:**
- `?type=all` (default) | `?type=publisher` | `?type=developer`
- All filter state persisted in URL for bookmarking and sharing

### Preset Views (4 Presets)

One-click filter configurations for common use cases:

| Preset | Description | Filters |
|--------|-------------|---------|
| Market Leaders | Top companies by revenue | $10M+ revenue, sorted by revenue |
| Rising Indies | Small studios with growth | â‰¤10 games, 10%+ 7d growth |
| Breakout | Rapid growth, smaller scale | 50%+ growth, <1M owners |
| Growing Publishers | Publishers with momentum | Publishers only, 10%+ growth |

Presets are **exclusive** - selecting one clears other presets and applies its sort order.

### Quick Filters (7 Filters)

Stackable toggle filters that can be combined:

| Filter | Description | Criteria |
|--------|-------------|----------|
| Major 10+ | Large catalogs | â‰¥10 games |
| Prolific 5+ | Established studios | â‰¥5 games |
| Active | Recent releases | Released in last 12 months |
| Trending | Growing CCU | Any positive growth |
| $1M+ | Revenue threshold | â‰¥$1M estimated revenue |
| $10M+ | High revenue | â‰¥$10M estimated revenue |
| 100K+ | Large audience | â‰¥100K total owners |

### Advanced Filters Panel

Collapsible panel with 9 filter categories:

**Metric Ranges:**
- Game Count (min/max)
- Total Owners (min/max)
- Peak CCU (min/max)
- Est. Weekly Hours (min/max)
- Est. Revenue (min/max)
- Avg Review Score (min/max)
- Total Reviews (min/max)

**Growth Filters:**
- CCU Growth 7d (min/max)
- CCU Growth 30d (min/max)

**Content Filters:**
- Genres (multi-select with "Has Any" / "Has All" mode)
- Tags (searchable dropdown with counts)
- Categories/Features (checkbox grid)
- Steam Deck (Verified / Playable / Any)
- Platforms (Windows / Mac / Linux with "Any" / "All" mode)

**Status & Relationship:**
- Activity Status (Active / Dormant)
- Relationship Type (Self-Published / External Devs / Multi-Publisher)

### Column Customization

17 columns across 7 categories with toggleable visibility:

| Category | Columns |
|----------|---------|
| Engagement | Est. Weekly Hours, Total Owners, Peak CCU |
| Content | Games, Unique Devs, Role |
| Reviews | Reviews, Avg Score, Review Velocity |
| Financial | Est. Gross Revenue |
| Growth | CCU Growth (7d), CCU Growth (30d), Trending |
| Ratios | Revenue/Game, Owners/Game, Reviews/1K Owners |
| Visualization | CCU Sparkline |

**Default Columns:** Hours, Games, Owners, CCU, Reviews, Revenue, 7d Growth, Trending

### Computed Ratio Columns

Client-side computed metrics for deeper analysis:

| Ratio | Formula | Insight |
|-------|---------|---------|
| Revenue/Game | Total Revenue Ã· Game Count | Average revenue per title |
| Owners/Game | Total Owners Ã· Game Count | Average game reach |
| Reviews/1K Owners | (Reviews Ã· Owners) Ã— 1000 | Audience engagement rate |

Ratio columns support client-side sorting.

### Compare Mode

Side-by-side comparison of 2-5 companies:

**Features:**
- Select companies via row checkboxes
- % difference from baseline (first selected company)
- "vs Average" column comparing to filtered average
- Best/worst values highlighted per row
- All metrics included: engagement, content, reviews, financial, growth, ratios
- Sparkline comparison
- Export comparison as CSV

**URL Format:** `?compare=pub:123,dev:456,pub:789`

### Export Functionality

Export data in CSV or JSON format:

| Option | Description |
|--------|-------------|
| Scope | All filtered results or selected companies only |
| Columns | Visible columns only or all metrics |
| Format | CSV or JSON |
| Filter Summary | Included as CSV comments |

### Saved Views

Save and load filter configurations:

- Save current filters, columns, sort, and type as named view
- Load saved views from dropdown
- Stored in localStorage (max 10 views)
- Delete or rename existing views

### Inline Sparklines

70Ã—24px CCU trend visualizations:

- Lazy-loaded via IntersectionObserver
- 7-day CCU data from `ccu_snapshots`
- Color-coded based on trend direction
- Fetched from `get_company_sparkline_data` RPC

### Growth Indicators

Color-coded growth display with emoji indicators:

| Growth | Emoji | Color |
|--------|-------|-------|
| â‰¥50% | ðŸš€ | Bright green |
| 10-49% | â†‘ | Green |
| -10% to 10% | â†’ | Gray |
| -49% to -10% | â†“ | Orange |
| â‰¤-50% | ðŸ“‰ | Red |

---

## Database Changes

### New RPC Functions

| Function | Purpose |
|----------|---------|
| `get_companies_with_filters()` | Main query with two-path optimization |
| `get_companies_aggregate_stats()` | Summary statistics for context bar |
| `get_company_sparkline_data()` | CCU time-series for sparklines |
| `get_filter_option_counts()` | Dynamic filter dropdown counts |
| `get_histogram_appids()` | Paginated histogram RPC for trends worker |

### `get_companies_with_filters` Parameters

Full parameter list for the main query RPC:

```sql
p_type TEXT DEFAULT 'all',              -- 'all', 'publisher', 'developer'
p_search TEXT DEFAULT NULL,
p_sort_by TEXT DEFAULT 'estimated_weekly_hours',
p_sort_order TEXT DEFAULT 'desc',
p_limit INT DEFAULT 50,
p_offset INT DEFAULT 0,
-- Metric filters
p_min_games INT, p_max_games INT,
p_min_owners BIGINT, p_max_owners BIGINT,
p_min_ccu INT, p_max_ccu INT,
p_min_hours BIGINT, p_max_hours BIGINT,
p_min_revenue BIGINT, p_max_revenue BIGINT,
p_min_score INT, p_max_score INT,
p_min_reviews INT, p_max_reviews INT,
-- Growth filters
p_min_growth_7d DECIMAL, p_max_growth_7d DECIMAL,
p_min_growth_30d DECIMAL, p_max_growth_30d DECIMAL,
-- Content filters
p_genres INT[], p_genre_mode TEXT,
p_tags INT[], p_categories INT[],
p_steam_deck TEXT, p_platforms TEXT[], p_platform_mode TEXT,
p_status TEXT, p_relationship TEXT
```

### Two-Path Query Optimization

The main RPC uses a two-path strategy for performance:

| Path | When Used | Performance | Growth Data |
|------|-----------|-------------|-------------|
| Fast Path | No growth/relationship filters | ~214ms | NULL |
| Slow Path | Growth filters or sort by growth | ~4s | Computed |

### Pre-Computed Content Arrays

Added to materialized views for O(1) filtering:

| Column | Type | Purpose |
|--------|------|---------|
| `genre_ids` | INT[] | Pre-computed genre IDs |
| `tag_ids` | INT[] | Pre-computed tag IDs |
| `category_ids` | INT[] | Pre-computed category IDs |
| `best_steam_deck_category` | TEXT | Best Steam Deck status across games |
| `has_windows` | BOOLEAN | Platform flag |
| `has_mac` | BOOLEAN | Platform flag |
| `has_linux` | BOOLEAN | Platform flag |

### Growth Metrics with 3-Day Windows

Pre-computed growth using ~6 days of CCU data instead of 14:

| Metric | Calculation |
|--------|-------------|
| `ccu_growth_7d_percent` | Compare 3-day avg (days 1-3) vs (days 4-6) |
| `ccu_growth_30d_percent` | Compare week 1 vs week 4 averages |
| `review_velocity_7d` | Reviews per day over 7 days |
| `review_velocity_30d` | Reviews per day over 30 days |

### GIN Indexes

Added for array containment queries:

```sql
CREATE INDEX idx_publisher_metrics_genres ON publisher_metrics USING GIN (genre_ids);
CREATE INDEX idx_publisher_metrics_tags ON publisher_metrics USING GIN (tag_ids);
CREATE INDEX idx_publisher_metrics_categories ON publisher_metrics USING GIN (category_ids);
-- Similar indexes for developer_metrics
```

---

## New Components

### Page Components

| Component | File | Purpose |
|-----------|------|---------|
| `page.tsx` | `companies/page.tsx` | Server component with data fetching |
| `CompaniesPageClient` | `components/CompaniesPageClient.tsx` | Main client orchestrator |
| `CompaniesTable` | `components/CompaniesTable.tsx` | Desktop table + mobile cards |
| `CompanyTypeToggle` | `components/CompanyTypeToggle.tsx` | All/Publishers/Developers toggle |
| `error.tsx` | `companies/error.tsx` | Error boundary |
| `loading.tsx` | `companies/loading.tsx` | Loading skeleton |

### Filter Components

| Component | File | Purpose |
|-----------|------|---------|
| `UnifiedFilterBar` | `components/UnifiedFilterBar.tsx` | Presets + quick filters |
| `SearchBar` | `components/SearchBar.tsx` | Name search with focus tracking |
| `AdvancedFiltersPanel` | `components/AdvancedFiltersPanel.tsx` | Collapsible filter panel |
| `MetricRangeFilters` | `filters/MetricRangeFilters.tsx` | Metric min/max ranges |
| `GrowthFilters` | `filters/GrowthFilters.tsx` | Growth metric ranges |
| `GenreTagFilter` | `filters/GenreTagFilter.tsx` | Multi-select with counts |
| `FeatureFilter` | `filters/FeatureFilter.tsx` | Checkbox grid |
| `PlatformFilter` | `filters/PlatformFilter.tsx` | Platform checkboxes |
| `SteamDeckFilter` | `filters/SteamDeckFilter.tsx` | Steam Deck compatibility |
| `ActivityFilter` | `filters/ActivityFilter.tsx` | Active/Dormant toggle |
| `RelationshipFilter` | `filters/RelationshipFilter.tsx` | Relationship type |
| `TimePeriodFilter` | `filters/TimePeriodFilter.tsx` | Time period selector |
| `DualRangeSlider` | `filters/DualRangeSlider.tsx` | Dual-handle range input |
| `RangeInput` | `filters/RangeInput.tsx` | Single range input |
| `SegmentedControl` | `filters/SegmentedControl.tsx` | Toggle button group |

### Display Components

| Component | File | Purpose |
|-----------|------|---------|
| `ContextBar` | `components/ContextBar.tsx` | Aggregate stats display |
| `GrowthCell` | `components/GrowthCell.tsx` | Color-coded growth indicator |
| `SparklineCell` | `components/SparklineCell.tsx` | Lazy-loaded sparklines |
| `MethodologyTooltip` | `components/MethodologyTooltip.tsx` | Column info tooltips |
| `ColumnSelector` | `components/ColumnSelector.tsx` | Column visibility toggle |
| `DataFreshnessFooter` | `components/DataFreshnessFooter.tsx` | Data sync status |
| `EmptyState` | `components/EmptyState.tsx` | No-results messaging |
| `FilterPill` | `components/FilterPill.tsx` | Active filter display |

### Selection & Export Components

| Component | File | Purpose |
|-----------|------|---------|
| `BulkActionsBar` | `components/BulkActionsBar.tsx` | Selection action bar |
| `CompareMode` | `components/CompareMode.tsx` | Side-by-side comparison |
| `ExportDialog` | `components/ExportDialog.tsx` | Export options dialog |
| `SavedViews` | `components/SavedViews.tsx` | Save/load filter views |

---

## Hooks

| Hook | File | Purpose |
|------|------|---------|
| `useCompaniesFilters` | `hooks/useCompaniesFilters.ts` | URL-based filter state (777 LOC) |
| `useCompaniesSelection` | `hooks/useCompaniesSelection.ts` | Row selection with shift+click |
| `useCompaniesCompare` | `hooks/useCompaniesCompare.ts` | Compare mode state |
| `useSavedViews` | `hooks/useSavedViews.ts` | localStorage view persistence |
| `useFilterCounts` | `hooks/useFilterCounts.ts` | Lazy-load filter option counts |
| `useSparklineLoader` | `hooks/useSparklineLoader.ts` | IntersectionObserver sparklines |

---

## Utility Libraries

| Library | File | Purpose |
|---------|------|---------|
| `companies-types.ts` | `lib/companies-types.ts` | TypeScript interfaces |
| `companies-queries.ts` | `lib/companies-queries.ts` | RPC wrappers + formatters |
| `companies-columns.ts` | `lib/companies-columns.ts` | Column definitions |
| `companies-presets.ts` | `lib/companies-presets.ts` | Preset/quick filter definitions |
| `companies-ratios.ts` | `lib/companies-ratios.ts` | Ratio computations |
| `companies-methodology.ts` | `lib/companies-methodology.ts` | Column methodology text |
| `companies-compare.ts` | `lib/companies-compare.ts` | Comparison row building |
| `companies-export.ts` | `lib/companies-export.ts` | CSV/JSON export formatting |

---

## Performance Optimizations

### Query Optimization

| Optimization | Impact |
|--------------|--------|
| Two-path query | Fast path ~214ms vs slow path ~4s |
| Pre-computed content arrays | Tag filtering: 7.7s â†’ <200ms |
| GIN indexes | Sub-millisecond array containment |
| 3-day growth windows | Requires 6 days CCU data vs 14 |

### Trends Worker Fix

Fixed timeout issue with histogram RPC pagination:

| Before | After |
|--------|-------|
| O(2.9M) pagination queries | O(1) single RPC call |
| 15+ minute timeout | <30 seconds |

**New RPC:** `get_histogram_appids()` returns all app IDs with review histograms in a single query.

### Client-Side Optimizations

| Pattern | Description |
|---------|-------------|
| Lazy sparklines | IntersectionObserver loads on scroll |
| Filter count caching | 5-minute cache for dropdown counts |
| Focus-tracking search | No debounce delay when typing |
| URL state | Avoids React state serialization |

---

## Migrations

| Migration | Description |
|-----------|-------------|
| `20260112200000_fix_waitlist_users_permission.sql` | Permission fix |
| `20260113000000_companies_page_rpcs.sql` | Initial 4 RPC functions |
| `20260114000000_add_max_filter_params.sql` | Max filter parameter support |
| `20260114100000_fix_filter_counts_rpc.sql` | Filter count aggregation fix |
| `20260114200000_optimize_companies_content_filters.sql` | Pre-computed content arrays |
| `20260115000000_add_content_arrays_to_metrics.sql` | Genre/tag/category arrays on views |
| `20260115100000_update_companies_rpc_for_arrays.sql` | Array containment queries |
| `20260115200000_fix_companies_filter_bugs.sql` | Filter validation fixes |
| `20260115300000_add_platform_filtering.sql` | Platform arrays + GIN indexes |
| `20260115400000_precompute_growth_metrics.sql` | Growth metric pre-computation |
| `20260115500000_use_3day_growth_windows.sql` | 3-day growth window calculation |
| `20260115600000_add_histogram_appids_rpc.sql` | Paginated histogram RPC |
| `20260115700000_velocity_with_3day_growth.sql` | Velocity metrics with 3-day windows |
| `20260116000000_fix_histogram_appids_rpc.sql` | Histogram RPC fix |

---

## Known Limitations

| Limitation | Description | Status |
|------------|-------------|--------|
| Time period filter | UI ready, backend not yet implemented | Planned |
| Route redirects | `/publishers` and `/developers` not redirecting to `/companies` | Planned |
| Per-game export | Export per-game breakdown for company | Coming soon |
| Real-time updates | Data refreshes on page load only | By design |

---

## GitHub Workflow Updates

| Workflow | Change |
|----------|--------|
| `refresh-views.yml` | Added `workflow_call` trigger |
| `trends-calculation.yml` | Added `workflow_call` trigger |

---

## Files Summary

| Category | Count |
|----------|-------|
| Page components | 6 |
| Filter components | 15 |
| Display components | 8 |
| Selection/Export components | 4 |
| Hooks | 6 |
| Utility libraries | 8 |
| Migrations | 14 |
| **Total new files** | **~62** |

---

## Related Documentation

- [Companies Page User Guide](../user-guide/companies-page.md) - How to use the Companies page
- [Companies Page Architecture](../developer-guide/features/companies-page.md) - Technical implementation details
- [Publishers & Developers Pages (Legacy)](../archive/publishers-developers-pages.md) - Previous implementation
- [Companies Page Spec](../specs/archived/companies-page-spec.md) - Original design specification
- [v2.4 Release Notes](v2.4-personalization.md) - Previous release
