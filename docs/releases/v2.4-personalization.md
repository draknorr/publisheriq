# v2.4 Release Notes - Personalized Dashboard

**Release Date:** January 12, 2026

---

## Overview

Version 2.4 introduces the **Personalized Dashboard** feature, allowing users to pin games, publishers, and developers they care about and receive automatic alerts when significant changes occur.

### Highlights

- **Pin Functionality** - Pin any game, publisher, or developer from their detail page
- **My Dashboard Tab** - New tab in Insights showing pinned items with live metrics
- **Smart Alerts** - 8 alert types detect CCU anomalies, trend reversals, review surges, and more
- **Alert Preferences** - Configurable sensitivity and per-type toggles
- **Real-time Triggers** - Instant alerts for price changes and new releases

---

## New Features

### Pin System

Pin any entity from its detail page to track it on your personalized dashboard:

- **Games**: Track CCU, reviews, price, and trends
- **Publishers**: Monitor portfolio and new releases
- **Developers**: Track releases and activity

**Integration Points:**
- Pin button on `/apps/{appid}`, `/publishers/{id}`, `/developers/{id}` pages
- Optimistic UI with rollback on error
- Authentication required

### My Dashboard Tab

New first tab in the Insights page (`/insights?tab=dashboard`):

| Section | Content |
|---------|---------|
| Recent Alerts | 5 most recent alerts with severity indicators |
| Pinned Items | Responsive grid of all pinned entities with metrics |

**Features:**
- Settings modal for alert preferences
- Empty state with browse links for new users
- Skeleton loading states
- Mobile-responsive layout (1/2/3/4 columns)

### Alert Detection System

Automatic detection of significant changes with 8 alert types:

| Alert Type | Trigger | Severity |
|------------|---------|----------|
| CCU Spike | +50% above 7-day average | Medium (High if >100%) |
| CCU Drop | -50% below 7-day average | Medium (High if >75%) |
| Trend Reversal | 30-day trend direction changed | Medium |
| Review Surge | Velocity >3x normal | Medium (High if >5x) |
| Sentiment Shift | Positive ratio changed >5% | Medium |
| Price Change | Any price/discount change | Low (High if >50% discount) |
| New Release | Pinned pub/dev released game | High |
| Milestone | Crossed 10K/50K/100K/500K/1M reviews | Medium (High if >100K) |

**Detection Methods:**
- **Hourly Worker**: CCU, trend, review, sentiment, milestone detection
- **Database Triggers**: Real-time price change and new release detection

### Alert Preferences

Configurable settings per user:

- **Global toggle**: Enable/disable all alerts
- **Per-type toggles**: Enable/disable specific alert types
- **Sensitivity sliders**: Adjust detection thresholds (0.5x to 2.0x)

---

## Database Changes

### New Enums

```sql
entity_type: 'game', 'publisher', 'developer'
alert_type: 'ccu_spike', 'ccu_drop', 'trend_reversal', 'review_surge',
            'sentiment_shift', 'price_change', 'new_release', 'milestone'
alert_severity: 'low', 'medium', 'high'
```

### New Tables

| Table | Purpose |
|-------|---------|
| `user_pins` | Pinned entities per user with ordering |
| `user_alerts` | Generated alerts with deduplication key |
| `user_alert_preferences` | Per-user alert configuration |
| `user_pin_alert_settings` | Per-pin alert overrides with inheritance |
| `alert_detection_state` | Baseline metrics for change detection |

### New RPC Functions

| Function | Purpose |
|----------|---------|
| `get_pinned_entities_with_metrics()` | Fetch all pinned entities with current metrics for alert detection |
| `get_user_pins_with_metrics(p_user_id)` | Fetch user's pins with metrics for dashboard display |

### Database Triggers

| Trigger | Table | Event | Purpose |
|---------|-------|-------|---------|
| `trigger_price_change_alert` | `apps` | UPDATE | Real-time price change alerts |
| `trigger_publisher_new_release` | `app_publishers` | INSERT | New release alerts for publishers |
| `trigger_developer_new_release` | `app_developers` | INSERT | New release alerts for developers |

### Row Level Security

- Users can only access their own pins, alerts, and preferences
- `alert_detection_state` accessible only via service role

---

## API Endpoints

### Pin Management

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/pins` | List user's pins with metrics |
| POST | `/api/pins` | Create a new pin |
| DELETE | `/api/pins/[id]` | Remove a pin |
| GET | `/api/pins/check` | Check if entity is pinned |

### Alert Management

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/alerts` | List alerts (with limit and unread filter) |
| GET | `/api/alerts/count` | Get unread alert count |
| DELETE | `/api/alerts/[id]` | Dismiss an alert |
| POST | `/api/alerts/[id]/read` | Mark alert as read |

### Preferences

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/alerts/preferences` | Get user's preferences |
| PUT | `/api/alerts/preferences` | Update preferences |

### Per-Pin Alert Settings

Override global preferences for individual pinned items:

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/pins/[id]/alert-settings` | Get per-pin settings with inheritance |
| PUT | `/api/pins/[id]/alert-settings` | Update per-pin overrides |

**Inheritance Model:**
- All fields nullable (NULL = inherit from global preferences)
- UI shows effective values and which are inherited vs custom
- Toggle `use_custom_settings` to enable per-pin overrides

---

## New Components

| Component | Location | Purpose |
|-----------|----------|---------|
| `PinButton` | `apps/admin/src/components/` | Pin/unpin toggle button |
| `AlertBadge` | `apps/admin/src/components/alerts/` | Sidebar unread count badge |
| `AlertFeed` | `apps/admin/src/components/alerts/` | Alert list with dismiss/read |
| `AlertPreferencesModal` | `apps/admin/src/components/alerts/` | Settings dialog |
| `PinAlertSettingsPanel` | `apps/admin/src/components/alerts/` | Per-pin settings panel |
| `MyDashboardTab` | `apps/admin/src/app/(main)/insights/components/` | Dashboard container |
| `PinnedCard` | `apps/admin/src/app/(main)/insights/components/` | Pinned entity card |

---

## Worker & Infrastructure

### Alert Detection Worker

**File:** `packages/ingestion/src/workers/alert-detection-worker.ts`

**Run Command:**
```bash
pnpm --filter @publisheriq/ingestion alert-detection
```

**Features:**
- Fetches all pinned entities with current metrics
- Runs 5 detection algorithms per entity
- Applies user sensitivity preferences
- Batch inserts alerts with deduplication
- Updates baseline state for next run
- Logs to `sync_jobs` table

### GitHub Actions Workflow

**File:** `.github/workflows/alert-detection.yml`

| Setting | Value |
|---------|-------|
| Schedule | Hourly at `:15` (after CCU sync) |
| Timeout | 10 minutes |
| Trigger | Also available via `workflow_dispatch` |

---

## Configuration

### Alert Thresholds

Added to `packages/shared/src/constants.ts`:

```typescript
ALERT_THRESHOLDS = {
  CCU_CHANGE_PERCENT: 50,           // 50% from baseline
  CCU_MIN_ABSOLUTE: 100,            // Skip if < 100 CCU
  REVIEW_VELOCITY_MULTIPLIER: 3,    // 3x above average
  REVIEW_MIN_DAILY: 5,              // Only if >= 5/day
  SENTIMENT_CHANGE_PERCENT: 5,      // 5% positive ratio change
  SENTIMENT_MIN_REVIEWS: 50,        // Only if >= 50 total reviews
  MILESTONES: [1000, 10000, 50000, 100000, 500000, 1000000]
}
```

### Deduplication Strategy

**Key Format:** `{user_id}:{entity_type}:{entity_id}:{alert_type}:{date}`

- Max 1 alert per type per entity per user per day
- Prevents spam while allowing re-alerts on subsequent days
- Implemented via UNIQUE constraint on `dedup_key`

---

## Migrations

| Migration File | Description |
|----------------|-------------|
| `20260112000001_add_momentum_rpcs.sql` | Momentum and sentiment RPC functions |
| `20260112000001_add_personalization.sql` | Core tables, enums, RLS policies, RPC functions |
| `20260112000002_add_alert_detection.sql` | Detection triggers and state update RPC |
| `20260112000002_add_momentum_to_embedding.sql` | Enhanced get_apps_for_embedding with momentum |
| `20260113000001_add_pin_alert_settings.sql` | Per-pin alert settings table |

---

## Known Limitations

| Limitation | Description | Planned Fix |
|------------|-------------|-------------|
| Publisher/Developer metrics | PinnedCard shows "View details" placeholder | v2.5 |
| Email digests | Preference exists but no email sending | Future |
| Pin reordering | `pin_order` column unused | Future |
| Aggregate alerts | No portfolio-level alerts for publishers/developers | v2.5 |

---

## Chat Enhancements (Qdrant Sprints 1-3)

These enhancements improve the AI chat interface with new semantic search and trend discovery capabilities.

### New LLM Tools

| Tool | Purpose |
|------|---------|
| `search_by_concept` | Semantic search using natural language descriptions |
| `discover_trending` | Trend-based game discovery (momentum, accelerating, breaking_out, declining) |

**search_by_concept**: Find games matching a concept without needing a reference game.
- Example: "tactical roguelikes with deck building"
- Uses OpenAI text-embedding-3-small (512 dims) to embed queries
- Supports all find_similar filters (price, platforms, Steam Deck, genres, tags, etc.)

**discover_trending**: Discover games by review momentum patterns.
- `review_momentum`: Highest review activity (most reviews/day)
- `accelerating`: Games where review rate is increasing (7d > 30d × 1.2)
- `breaking_out`: Hidden gems gaining attention (accelerating + 100-10K reviews)
- `declining`: Games losing momentum (7d < 30d × 0.8)

### Enhanced Embeddings

Game embeddings now include temporal/momentum data for improved relevance:

| Data | Source | Condition |
|------|--------|-----------|
| CCU momentum | ccu_snapshots | Shows if growth ≥ 10% |
| Review velocity | review_velocity_stats | Shows if velocity > 0 |
| Sentiment trajectory | reviews vs historical | Shows if delta ≥ 2% |

Example embedding text additions:
- "Momentum: +45% CCU week-over-week, +120% vs 30-day avg"
- "Review velocity: 5.2/day, Accelerating (+2.1/day)"
- "Recent sentiment: 97% positive (vs 95% historical, improving)"

### Storage Optimization

| Optimization | Savings |
|--------------|---------|
| Dimension reduction (1536 → 512) | ~67% |
| Int8 scalar quantization | ~75% (vs float32) |
| On-disk payloads | ~50% RAM |
| **Combined total** | **~90%** |

### New RPC Functions

| Function | Purpose |
|----------|---------|
| `get_game_momentum(p_appid)` | Returns CCU growth (7d, 30d), velocity, acceleration |
| `get_sentiment_trajectory(p_appid)` | Returns recent vs historical positive %, delta |
| `get_apps_for_embedding` (updated) | Now includes 7 new momentum columns |

### Files Modified

| File | Changes |
|------|---------|
| `apps/admin/src/lib/llm/cube-tools.ts` | Added search_by_concept, discover_trending tools |
| `apps/admin/src/lib/search/game-search.ts` | Enhanced search_games with publisher/developer data |
| `apps/admin/src/lib/search/trend-discovery.ts` | New trend execution function |
| `apps/admin/src/lib/qdrant/search-service.ts` | Added searchByConcept() |
| `apps/admin/src/app/api/chat/stream/route.ts` | Handler wiring for new tools |
| `apps/admin/src/lib/llm/cube-system-prompt.ts` | Documentation for new tools |
| `packages/ingestion/src/apis/embedding.ts` | Enhanced embedding text with momentum |
| `packages/qdrant/src/collections.ts` | Dimension reduction (1536 → 512) |

---

## Related Documentation

- [User Guide](../user-guide/personalization.md) - How to use the personalization feature
- [Smart Query Suggestions](../developer-guide/features/smart-query-suggestions.md) - Type-ahead autocomplete and chips
- [Chat Interface Guide](../user-guide/chat-interface.md) - Using concept search and trending discovery
- [Architecture](../developer-guide/features/personalization.md) - Personalization technical details
- [Chat Data System](../developer-guide/architecture/chat-data-system.md) - Full chat/Cube.js reference
- [v2.3 Release Notes](v2.3-embedding-optimization.md) - Previous release
